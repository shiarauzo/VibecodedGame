<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Llama Hackaton Adventure - Prototipo</title>
    <style>
        body {
            margin: 0;
            background-color: #202028;
            color: white;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }
        #game-container {
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        canvas {
            background: linear-gradient(to bottom, #87CEEB, #E0F7FA); /* Cielo */
            display: block;
            border-radius: 4px;
        }
        #ui-layer {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: center;
            pointer-events: none;
        }
        #timer-display {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 24px;
            font-weight: bold;
            color: #333;
            background: rgba(255,255,255,0.8);
            padding: 5px 10px;
            border-radius: 5px;
            border: 2px solid #333;
        }
        .letter-slot {
            width: 30px;
            height: 40px;
            background: rgba(0,0,0,0.3);
            margin: 0 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            color: rgba(255,255,255,0.2);
            border: 2px solid white;
            border-radius: 4px;
        }
        .letter-slot.collected {
            background: #FFD700;
            color: #000;
            animation: pop 0.3s ease;
        }
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        #controls-hint {
            margin-top: 10px;
            font-size: 0.9em;
            color: #aaa;
        }
        #win-screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            padding: 30px;
            text-align: center;
            display: none;
            border-radius: 10px;
            border: 4px solid #FFD700;
            min-width: 300px;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <canvas id="gameCanvas" width="800" height="400"></canvas>
        <div id="timer-display">0.00s</div>
        <div id="ui-layer">
            <div id="letters-container" style="display: flex;"></div>
        </div>
        <div id="win-screen">
            <h1 style="color: #FFD700; margin: 0 0 10px 0;">¡IA HACKATON PERU!</h1>
            <p style="font-size: 1.2em;">¡Misión Completada!</p>
            <p id="final-time" style="color: #4CAF50; font-size: 1.5em; font-weight: bold; margin: 10px 0;">Tiempo: 0.00s</p>
            <button onclick="location.reload()" style="padding: 10px 20px; cursor: pointer; font-size: 1.1em; background: #FFD700; border: none; border-radius: 5px; color: black; font-weight: bold;">Jugar de nuevo</button>
        </div>
    </div>
    <div id="controls-hint">Usa las FLECHAS para moverte | ESPACIO para saltar</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const timerDisplay = document.getElementById('timer-display');

    // Configuración del juego
    const VIEWPORT_WIDTH = 800;
    const GAME_HEIGHT = 400;
    const WORLD_WIDTH = 8500; 
    const GRAVITY = 0.6;
    
    // Frase Objetivo
    const TARGET_PHRASE = "IAHACKATONPERU".split('');
    let collectedIndices = new Set();
    
    // Estado del juego
    let gameStartTime = 0;
    let gameEnded = false;
    let finalFlag = { x: 0, y: 0, reached: false };

    // Estado de teclas
    const keys = {
        ArrowRight: false,
        ArrowLeft: false,
        Space: false,
        ArrowUp: false
    };

    // Clase Jugador
    class Player {
        constructor() {
            this.width = 40;
            this.height = 40;
            this.x = 50;
            this.y = GAME_HEIGHT - 100;
            this.vx = 0;
            this.vy = 0;
            this.speed = 6;
            this.jumpPower = -13;
            this.grounded = false;
            this.facingRight = true;
            this.color = '#8B4513';
        }

        update() {
            if (gameEnded) return;

            // Movimiento horizontal
            if (keys.ArrowRight) {
                this.vx = this.speed;
                this.facingRight = true;
            } else if (keys.ArrowLeft) {
                this.vx = -this.speed;
                this.facingRight = false;
            } else {
                this.vx *= 0.8;
            }

            // Salto
            if ((keys.Space || keys.ArrowUp) && this.grounded) {
                this.vy = this.jumpPower;
                this.grounded = false;
            }

            // Física Vertical
            this.vy += GRAVITY;
            this.x += this.vx;
            this.y += this.vy;

            // Límites del mundo
            if (this.x < 0) this.x = 0;
            if (this.x > WORLD_WIDTH - this.width) this.x = WORLD_WIDTH - this.width;

            // Colisiones con plataformas
            this.grounded = false;
            platforms.forEach(platform => {
                const dir = this.colCheck(this, platform);
                if (dir === "b") { 
                    this.grounded = true;
                    this.vy = 0;
                }
            });
            
            // Caída al vacío (Respawn)
            if (this.y > GAME_HEIGHT) {
                this.x = Math.max(50, this.x - 300); // Castigo leve
                this.y = 0;
                this.vy = 0;
            }

            // Chequear Victoria (Bandera)
            if (this.x + this.width > finalFlag.x && this.x < finalFlag.x + 10) {
                // Solo si está cerca del suelo y tiene todas las letras
                if (this.y > finalFlag.y - 100 && collectedIndices.size === TARGET_PHRASE.length) {
                    finishGame();
                }
            }
        }

        draw() {
            ctx.save();
            ctx.translate(Math.floor(this.x + this.width/2), Math.floor(this.y + this.height/2));
            if (!this.facingRight) ctx.scale(-1, 1);
            
            // Cuerpo
            ctx.fillStyle = this.color;
            ctx.fillRect(-20, -10, 40, 20);
            
            // Patas
            if (Math.abs(this.vx) > 0.5 && !this.grounded === false) {
                const walk = Math.sin(Date.now() / 100) * 10;
                ctx.fillRect(-18 + walk, 10, 8, 15);
                ctx.fillRect(10 - walk, 10, 8, 15);
            } else {
                ctx.fillRect(-18, 10, 8, 15);
                ctx.fillRect(10, 10, 8, 15);
            }

            // Cuello/Cabeza
            ctx.fillRect(10, -30, 10, 30);
            // Orejas
            ctx.fillStyle = '#5D4037';
            ctx.fillRect(12, -35, 3, 8);
            ctx.fillRect(17, -35, 3, 8);
            // Ojo
            ctx.fillStyle = 'white';
            ctx.fillRect(13, -25, 4, 4);
            ctx.fillStyle = 'black';
            ctx.fillRect(15, -25, 2, 2);
            
            // Manta peruana
            ctx.fillStyle = '#E91E63'; 
            ctx.fillRect(-10, -10, 5, 20);
            ctx.fillStyle = '#FFEB3B'; 
            ctx.fillRect(-5, -10, 5, 20);
            ctx.fillStyle = '#2196F3'; 
            ctx.fillRect(0, -10, 5, 20);

            ctx.restore();
        }

        colCheck(shapeA, shapeB) {
            const vX = (shapeA.x + (shapeA.width / 2)) - (shapeB.x + (shapeB.width / 2));
            const vY = (shapeA.y + (shapeA.height / 2)) - (shapeB.y + (shapeB.height / 2));
            const hWidths = (shapeA.width / 2) + (shapeB.width / 2);
            const hHeights = (shapeA.height / 2) + (shapeB.height / 2);
            let colDir = null;

            if (Math.abs(vX) < hWidths && Math.abs(vY) < hHeights) {
                const oX = hWidths - Math.abs(vX);
                const oY = hHeights - Math.abs(vY);
                if (oX >= oY) {
                    if (vY > 0) {
                        colDir = "t"; 
                        shapeA.y += oY;
                    } else {
                        colDir = "b"; 
                        shapeA.y -= oY;
                    }
                } else {
                    if (vX > 0) {
                        colDir = "l";
                        shapeA.x += oX;
                    } else {
                        colDir = "r";
                        shapeA.x -= oX;
                    }
                }
            }
            return colDir;
        }
    }

    let player = new Player();
    let platforms = [];
    let letters = [];
    let cameraX = 0;

    function initLevel() {
        platforms = [];
        letters = [];
        gameEnded = false;
        collectedIndices.clear();
        gameStartTime = Date.now();
        document.getElementById('win-screen').style.display = 'none';

        // Suelo Base Seguro (Primer tramo)
        platforms.push({ x: 0, y: GAME_HEIGHT - 40, width: 800, height: 40, color: '#4CAF50' });

        const phrase = "IAHACKATONPERU".split('');
        let currentX = 600; 

        phrase.forEach((char, index) => {
            // Gap reducido para facilitar saltos (entre 250 y 400 pixels)
            // Antes era 400-600, lo cual era difícil para el salto de la llama
            const gap = 250 + Math.random() * 150; 
            currentX += gap;

            const yPos = 180 + Math.random() * 100; // Altura más controlada
            
            // Plataforma Principal de la letra
            platforms.push({ 
                x: currentX - 60, 
                y: yPos + 40, 
                width: 140, // Plataforma más ancha para aterrizar seguro
                height: 20, 
                color: '#8D6E63' 
            });

            // Plataformas intermedias de "puente" si el salto es muy largo
            if (gap > 350) {
                platforms.push({
                    x: currentX - (gap/2) - 40,
                    y: yPos + 80 + (Math.random()*20),
                    width: 80,
                    height: 20,
                    color: '#8D6E63'
                });
            }
            
            letters.push({
                char: char,
                targetIndex: index,
                x: currentX - 10,
                y: yPos,
                width: 30,
                height: 30,
                collected: false
            });
        });

        // Zona Final (Bandera)
        const finalX = currentX + 400;
        platforms.push({ x: finalX, y: GAME_HEIGHT - 60, width: 400, height: 60, color: '#FFD700' }); // Suelo dorado final
        
        finalFlag = {
            x: finalX + 200,
            y: GAME_HEIGHT - 60,
            reached: false
        };

        // UI Inicial
        const uiContainer = document.getElementById('letters-container');
        uiContainer.innerHTML = '';
        TARGET_PHRASE.forEach((char, i) => {
            const div = document.createElement('div');
            div.className = 'letter-slot';
            div.id = `slot-${i}`;
            div.innerText = char;
            uiContainer.appendChild(div);
        });
    }

    function update() {
        if (!gameEnded) {
            // Actualizar Timer
            const now = Date.now();
            const diff = (now - gameStartTime) / 1000;
            timerDisplay.innerText = diff.toFixed(2) + "s";
        }

        player.update();

        // Cámara
        cameraX = player.x - 200;
        if (cameraX < 0) cameraX = 0;
        if (cameraX > WORLD_WIDTH - VIEWPORT_WIDTH) cameraX = WORLD_WIDTH - VIEWPORT_WIDTH;

        // Colisión Letras
        letters.forEach(letter => {
            if (!letter.collected) {
                if (player.x < letter.x + letter.width &&
                    player.x + player.width > letter.x &&
                    player.y < letter.y + letter.height &&
                    player.y + player.height > letter.y) {
                    
                    collectLetter(letter);
                }
            }
        });
    }

    function collectLetter(letter) {
        if(letter.collected) return;
        letter.collected = true;
        collectedIndices.add(letter.targetIndex);
        
        const slot = document.getElementById(`slot-${letter.targetIndex}`);
        slot.classList.add('collected');
    }

    function finishGame() {
        if (gameEnded) return;
        gameEnded = true;
        
        // Calcular tiempo final
        const now = Date.now();
        const diff = (now - gameStartTime) / 1000;
        
        document.getElementById('final-time').innerText = "Tiempo Final: " + diff.toFixed(2) + "s";
        document.getElementById('win-screen').style.display = 'block';
    }

    function drawFlag(x, y) {
        // Mástil
        ctx.fillStyle = '#555';
        ctx.fillRect(x, y - 150, 5, 150);
        
        // Base
        ctx.fillStyle = '#333';
        ctx.fillRect(x - 10, y, 25, 10);

        // Bandera Peruana
        const wave = Math.sin(Date.now() / 200) * 5; // Efecto de viento
        const flagY = y - 150;
        const flagH = 60;
        const stripeW = 30;

        // Franja Roja 1
        ctx.fillStyle = '#D91023';
        ctx.fillRect(x + 5, flagY, stripeW, flagH + wave);
        
        // Franja Blanca
        ctx.fillStyle = '#FFFFFF';
        ctx.fillRect(x + 5 + stripeW, flagY + (wave*0.5), stripeW, flagH + wave);
        
        // Franja Roja 2
        ctx.fillStyle = '#D91023';
        ctx.fillRect(x + 5 + (stripeW*2), flagY + wave, stripeW, flagH + wave);
    }

    function drawBackground() {
        const parallaxX = cameraX * 0.2;
        ctx.fillStyle = '#455A64'; 
        ctx.beginPath();
        ctx.moveTo(0, GAME_HEIGHT);
        for(let i=0; i < WORLD_WIDTH + VIEWPORT_WIDTH; i+= 200) {
            const h = 200 + Math.sin(i * 0.01) * 100;
            ctx.lineTo(i - parallaxX, GAME_HEIGHT - h);
        }
        ctx.lineTo(WORLD_WIDTH, GAME_HEIGHT);
        ctx.fill();

        // Ruinas
        const ruinX = cameraX * 0.5;
        ctx.fillStyle = '#5D4037'; 
        for (let i = 100; i < WORLD_WIDTH; i+= 500) {
            if (i > cameraX - 100 && i < cameraX + VIEWPORT_WIDTH + 100) {
                 const xPos = i - ruinX + (i*0.3);
                 ctx.fillRect(xPos, GAME_HEIGHT - 150, 200, 150);
                 ctx.fillStyle = '#795548';
                 ctx.fillRect(xPos + 10, GAME_HEIGHT - 130, 180, 20);
                 ctx.fillRect(xPos + 20, GAME_HEIGHT - 110, 160, 20);
                 ctx.fillStyle = '#8D6E63';
                 ctx.beginPath();
                 ctx.moveTo(xPos + 50, GAME_HEIGHT - 150);
                 ctx.lineTo(xPos + 100, GAME_HEIGHT - 200); 
                 ctx.lineTo(xPos + 150, GAME_HEIGHT - 150);
                 ctx.fill();
                 ctx.fillStyle = '#5D4037'; 
            }
        }
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawBackground();

        ctx.save();
        ctx.translate(-cameraX, 0);

        // Plataformas
        platforms.forEach(p => {
            ctx.fillStyle = p.color;
            ctx.fillRect(p.x, p.y, p.width, p.height);
            if (p.color === '#4CAF50') {
                ctx.fillStyle = '#388E3C';
                ctx.fillRect(p.x, p.y, p.width, 5); 
            } else if (p.color === '#8D6E63') {
                ctx.fillStyle = '#5D4037';
                ctx.fillRect(p.x, p.y, p.width, 2);
                ctx.fillRect(p.x, p.y + 10, p.width, 2);
            }
        });

        // Bandera Final
        drawFlag(finalFlag.x, finalFlag.y);

        // Letras
        ctx.font = "bold 24px Arial";
        ctx.textAlign = "center";
        letters.forEach(l => {
            if (!l.collected) {
                const floatY = Math.sin(Date.now() / 200) * 5;
                ctx.fillStyle = 'rgba(255, 215, 0, 0.5)';
                ctx.beginPath();
                ctx.arc(l.x + 15, l.y + 15 + floatY, 25, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = 'yellow';
                ctx.beginPath();
                ctx.arc(l.x + 15, l.y + 15 + floatY, 20, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = 'black';
                ctx.fillText(l.char, l.x + 15, l.y + 24 + floatY);
            }
        });

        // Indicador sobre el jugador si faltan letras
        if (player.x + player.width > finalFlag.x - 300 && collectedIndices.size < TARGET_PHRASE.length) {
            ctx.fillStyle = "white";
            ctx.font = "14px Arial";
            ctx.fillText("¡Faltan letras!", player.x + 20, player.y - 20);
        }

        player.draw();
        ctx.restore();
        
        requestAnimationFrame(loop);
    }

    function loop() {
        update();
        draw();
    }

    window.addEventListener('keydown', e => {
        if(keys.hasOwnProperty(e.code) || e.code === 'Space') {
            keys[e.code === 'Space' ? 'Space' : e.code] = true;
            if(e.code === 'Space') e.preventDefault();
        }
    });

    window.addEventListener('keyup', e => {
        if(keys.hasOwnProperty(e.code) || e.code === 'Space') {
            keys[e.code === 'Space' ? 'Space' : e.code] = false;
        }
    });

    initLevel();
    loop();

</script>
</body>
</html>